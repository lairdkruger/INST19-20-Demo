{"ast":null,"code":"import _objectWithoutProperties from\"/Users/lairdkruger/Documents/Web Development/Work/inst19-20/Sites/Demo/INST19-20-Demo/INST19-20-Demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import React,{createContext,useRef,useContext}from'react';import{useFrame,useThree}from'react-three-fiber';import lerp from'lerp';import state from'../store';// Nestable content block for a declarative scroll rig\n// Based on Paul Henschel's work:\n// https://tympanus.net/codrops/2019/12/16/scroll-refraction-and-shader-effects-in-three-js-and-react/\n// Offset: section index (eg: offset = 2 will be the third content section)\n// Factor: sets block's speed when page is scrolled\nconst offsetContext=createContext(0);function Block(_ref){let children=_ref.children,offset=_ref.offset,factor=_ref.factor,props=_objectWithoutProperties(_ref,[\"children\",\"offset\",\"factor\"]);// Fetch parent offset and the height of a single section\nconst _useBlock=useBlock(),parentOffset=_useBlock.offset,sectionHeight=_useBlock.sectionHeight,aspect=_useBlock.aspect,canvasHeight=_useBlock.canvasHeight;const ref=useRef();offset=offset!==undefined?offset:parentOffset;// Runs every frame and lerps the inner block into its place\nuseFrame(()=>{const curY=ref.current.position.y;const curTop=Math.min(state.top.current/aspect,canvasHeight*(state.pages-1));ref.current.position.y=lerp(curY,curTop/state.zoom*factor,0.1);});setInterval(function(){// console.log(canvasHeight * (state.pages - 1))\n},1000);return/*#__PURE__*/React.createElement(offsetContext.Provider,{value:offset},/*#__PURE__*/React.createElement(\"group\",Object.assign({},props,{position:[0,-sectionHeight*offset*factor,0]}),/*#__PURE__*/React.createElement(\"group\",{ref:ref},children)));}function useBlock(){const sections=state.sections,pages=state.pages,zoom=state.zoom;const _useThree=useThree(),size=_useThree.size,viewport=_useThree.viewport;const offset=useContext(offsetContext);const viewportWidth=viewport.width;const viewportHeight=viewport.height;const canvasWidth=viewportWidth/zoom;const canvasHeight=viewportHeight/zoom;const mobile=size.width<700;const margin=canvasWidth*(mobile?0.2:0.1);const contentMaxWidth=canvasWidth*(mobile?0.8:0.6);const sectionHeight=canvasHeight*((pages-1)/(sections-1));const aspect=size.height/viewportHeight;return{aspect,viewport,offset,viewportWidth,viewportHeight,canvasWidth,canvasHeight,mobile,margin,contentMaxWidth,sectionHeight};}export{Block,useBlock};","map":{"version":3,"sources":["/Users/lairdkruger/Documents/Web Development/Work/inst19-20/Sites/Demo/INST19-20-Demo/INST19-20-Demo/src/components/Blocks.js"],"names":["React","createContext","useRef","useContext","useFrame","useThree","lerp","state","offsetContext","Block","children","offset","factor","props","useBlock","parentOffset","sectionHeight","aspect","canvasHeight","ref","undefined","curY","current","position","y","curTop","Math","min","top","pages","zoom","setInterval","sections","size","viewport","viewportWidth","width","viewportHeight","height","canvasWidth","mobile","margin","contentMaxWidth"],"mappings":"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","sourcesContent":["import React, {createContext, useRef, useContext} from 'react'\nimport {useFrame, useThree} from 'react-three-fiber'\nimport lerp from 'lerp'\nimport state from '../store'\n\n// Nestable content block for a declarative scroll rig\n// Based on Paul Henschel's work:\n// https://tympanus.net/codrops/2019/12/16/scroll-refraction-and-shader-effects-in-three-js-and-react/\n\n// Offset: section index (eg: offset = 2 will be the third content section)\n// Factor: sets block's speed when page is scrolled\n\nconst offsetContext = createContext(0)\n\nfunction Block({children, offset, factor, ...props}) {\n    // Fetch parent offset and the height of a single section\n    const {offset: parentOffset, sectionHeight, aspect, canvasHeight} = useBlock()\n    const ref = useRef()\n    offset = offset !== undefined ? offset : parentOffset\n\n    // Runs every frame and lerps the inner block into its place\n    useFrame(() => {\n        const curY = ref.current.position.y\n        const curTop = Math.min(\n            state.top.current / aspect,\n            canvasHeight * (state.pages - 1)\n        )\n\n        ref.current.position.y = lerp(curY, (curTop / state.zoom) * factor, 0.1)\n    })\n\n    setInterval(function () {\n        // console.log(canvasHeight * (state.pages - 1))\n    }, 1000)\n\n    return (\n        <offsetContext.Provider value={offset}>\n            <group {...props} position={[0, -sectionHeight * offset * factor, 0]}>\n                <group ref={ref}>{children}</group>\n            </group>\n        </offsetContext.Provider>\n    )\n}\n\nfunction useBlock() {\n    const {sections, pages, zoom} = state\n    const {size, viewport} = useThree()\n    const offset = useContext(offsetContext)\n    const viewportWidth = viewport.width\n    const viewportHeight = viewport.height\n    const canvasWidth = viewportWidth / zoom\n    const canvasHeight = viewportHeight / zoom\n    const mobile = size.width < 700\n    const margin = canvasWidth * (mobile ? 0.2 : 0.1)\n    const contentMaxWidth = canvasWidth * (mobile ? 0.8 : 0.6)\n    const sectionHeight = canvasHeight * ((pages - 1) / (sections - 1))\n    const aspect = size.height / viewportHeight\n    return {\n        aspect,\n        viewport,\n        offset,\n        viewportWidth,\n        viewportHeight,\n        canvasWidth,\n        canvasHeight,\n        mobile,\n        margin,\n        contentMaxWidth,\n        sectionHeight,\n    }\n}\n\nexport {Block, useBlock}\n"]},"metadata":{},"sourceType":"module"}