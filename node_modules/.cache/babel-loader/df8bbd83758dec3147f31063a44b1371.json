{"ast":null,"code":"import _objectWithoutProperties from \"/Users/lairdkruger/Documents/Web Development/Work/inst19-20/Sites/INST19/INST19/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"/Users/lairdkruger/Documents/Web Development/Work/inst19-20/Sites/INST19/INST19/src/components/Blocks.js\";\nimport React, { createContext, useRef, useContext, useEffect } from 'react';\nimport { useFrame, useThree } from 'react-three-fiber';\nimport lerp from 'lerp';\nimport state from '../store'; // Nestable content block for a declarative scroll rig\n// Based on Paul Henschel's work:\n// https://tympanus.net/codrops/2019/12/16/scroll-refraction-and-shader-effects-in-three-js-and-react/\n// Offset: section index (eg: offset = 2 will be the third content section)\n// Factor: sets block's speed when page is scrolled\n\nconst offsetContext = createContext(0);\n\nfunction Block(_ref) {\n  let children = _ref.children,\n      offset = _ref.offset,\n      factor = _ref.factor,\n      props = _objectWithoutProperties(_ref, [\"children\", \"offset\", \"factor\"]);\n\n  // Fetch parent offset and the height of a single section\n  const _useBlock = useBlock(),\n        parentOffset = _useBlock.offset,\n        sectionHeight = _useBlock.sectionHeight,\n        aspect = _useBlock.aspect,\n        viewportWidth = _useBlock.viewportWidth;\n\n  const ref = useRef();\n  offset = offset !== undefined ? offset : parentOffset; // Runs every frame and lerps the inner block into its place\n\n  useFrame(() => {\n    const curY = ref.current.position.y;\n    const curX = ref.current.position.x;\n    const curTop = state.top.current / aspect;\n\n    if (props.horizontal) {\n      ref.current.position.x = lerp(curY, viewportWidth / 2 * factor, 0.1);\n      ref.current.position.y = lerp(curY, curTop / state.zoom * factor, 0.1);\n    } else {\n      ref.current.position.y = lerp(curY, curTop / state.zoom * factor, 0.1);\n    }\n  });\n  return /*#__PURE__*/React.createElement(offsetContext.Provider, {\n    value: offset,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"group\", Object.assign({}, props, {\n    position: [0, -sectionHeight * offset * factor, 0],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"group\", {\n    ref: ref,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 17\n    }\n  }, children)));\n}\n\nfunction useBlock() {\n  const sections = state.sections,\n        pages = state.pages,\n        zoom = state.zoom;\n\n  const _useThree = useThree(),\n        size = _useThree.size,\n        viewport = _useThree.viewport;\n\n  const offset = useContext(offsetContext);\n  const viewportWidth = viewport.width;\n  const viewportHeight = viewport.height;\n  const canvasWidth = viewportWidth / zoom;\n  const canvasHeight = viewportHeight / zoom;\n  const mobile = size.width < 700;\n  const margin = canvasWidth * (mobile ? 0.2 : 0.1);\n  const contentMaxWidth = canvasWidth * (mobile ? 0.8 : 0.6);\n  const sectionHeight = canvasHeight * ((pages - 1) / (sections - 1));\n  const aspect = size.height / viewportHeight;\n  return {\n    aspect,\n    viewport,\n    offset,\n    viewportWidth,\n    viewportHeight,\n    canvasWidth,\n    canvasHeight,\n    mobile,\n    margin,\n    contentMaxWidth,\n    sectionHeight\n  };\n}\n\nexport { Block, useBlock };","map":{"version":3,"sources":["/Users/lairdkruger/Documents/Web Development/Work/inst19-20/Sites/INST19/INST19/src/components/Blocks.js"],"names":["React","createContext","useRef","useContext","useEffect","useFrame","useThree","lerp","state","offsetContext","Block","children","offset","factor","props","useBlock","parentOffset","sectionHeight","aspect","viewportWidth","ref","undefined","curY","current","position","y","curX","x","curTop","top","horizontal","zoom","sections","pages","size","viewport","width","viewportHeight","height","canvasWidth","canvasHeight","mobile","margin","contentMaxWidth"],"mappings":"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","sourcesContent":["import React, {createContext, useRef, useContext, useEffect} from 'react'\nimport {useFrame, useThree} from 'react-three-fiber'\nimport lerp from 'lerp'\nimport state from '../store'\n\n// Nestable content block for a declarative scroll rig\n// Based on Paul Henschel's work:\n// https://tympanus.net/codrops/2019/12/16/scroll-refraction-and-shader-effects-in-three-js-and-react/\n\n// Offset: section index (eg: offset = 2 will be the third content section)\n// Factor: sets block's speed when page is scrolled\n\nconst offsetContext = createContext(0)\n\nfunction Block({children, offset, factor, ...props}) {\n    // Fetch parent offset and the height of a single section\n    const {offset: parentOffset, sectionHeight, aspect, viewportWidth} = useBlock()\n    const ref = useRef()\n    offset = offset !== undefined ? offset : parentOffset\n\n    // Runs every frame and lerps the inner block into its place\n    useFrame(() => {\n        const curY = ref.current.position.y\n        const curX = ref.current.position.x\n\n        const curTop = state.top.current / aspect\n\n        if (props.horizontal) {\n            ref.current.position.x = lerp(curY, (viewportWidth / 2) * factor, 0.1)\n            ref.current.position.y = lerp(curY, (curTop / state.zoom) * factor, 0.1)\n        } else {\n            ref.current.position.y = lerp(curY, (curTop / state.zoom) * factor, 0.1)\n        }\n    })\n\n    return (\n        <offsetContext.Provider value={offset}>\n            <group {...props} position={[0, -sectionHeight * offset * factor, 0]}>\n                <group ref={ref}>{children}</group>\n            </group>\n        </offsetContext.Provider>\n    )\n}\n\nfunction useBlock() {\n    const {sections, pages, zoom} = state\n    const {size, viewport} = useThree()\n    const offset = useContext(offsetContext)\n    const viewportWidth = viewport.width\n    const viewportHeight = viewport.height\n    const canvasWidth = viewportWidth / zoom\n    const canvasHeight = viewportHeight / zoom\n    const mobile = size.width < 700\n    const margin = canvasWidth * (mobile ? 0.2 : 0.1)\n    const contentMaxWidth = canvasWidth * (mobile ? 0.8 : 0.6)\n    const sectionHeight = canvasHeight * ((pages - 1) / (sections - 1))\n    const aspect = size.height / viewportHeight\n    return {\n        aspect,\n        viewport,\n        offset,\n        viewportWidth,\n        viewportHeight,\n        canvasWidth,\n        canvasHeight,\n        mobile,\n        margin,\n        contentMaxWidth,\n        sectionHeight,\n    }\n}\n\nexport {Block, useBlock}\n"]},"metadata":{},"sourceType":"module"}